{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/php_func_del_file/","result":{"data":{"markdownRemark":{"id":"48b36b85-8c41-593a-980a-f51d7f2b65cc","html":"<div class=\"toc-title\">目次</div>\n<div class=\"toc-block\">\n<ol>\n<li><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\">はじめに</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89\">コード</a></li>\n</ol>\n</div>\n<h2 id=\"はじめに\" style=\"position:relative;\"><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\" aria-label=\"はじめに permalink\" class=\"toc-icon before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>はじめに</h2>\n<p>ファイルを削除する関数を書いたので載せておきます。</p>\n<p>ファイル、ディレクトリを操作するメソッドはいろいろありますが、今回はis_Dot()がつかえる、DirectoryIteratorクラスを使っています。</p>\n<p>引数で以下の設定ができます。</p>\n<ul>\n<li>削除対象のフォルダパス</li>\n<li>削除対象の拡張子</li>\n<li>\n<div><div>〇日前のファイルを削除対象とするか</div></div>\n</li>\n</ul>\n<p>パスがファイルの場合に条件を満たせば削除し、パスがフォルダなら再帰処理を行い配下のフォルダまですべて処理を行います。</p>\n<p>なお、<span style=\"color: #ff0000;\"><strong>$pathに渡したフォルダのパスのファイルが削除対象</strong></span>になります。</p>\n<p><span style=\"color: #ff0000;\"><strong>ご利用の際は動作確認を行ったうえで、自己責任でお願いします。</strong></span><br>\n<span style=\"color: #ff0000;\"><strong>ファイルを消すものなので、テストして慎重に使ってください</strong></span>。</p>\n<div class=\"boxparts ref\">\n  <div class=\"title\"></div>\n<p>DirectoryIterator クラス<br>\n<a href=\"https://www.php.net/manual/ja/class.directoryiterator.php\">https://www.php.net/manual/ja/class.directoryiterator.php</a></p>\n</div>\n<h2 id=\"コード\" style=\"position:relative;\"><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89\" aria-label=\"コード permalink\" class=\"toc-icon before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>コード</h2>\n\n        <div class=\"gatsby-code-title your-custom-class-name\">\n          <span>php</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">/**\n * $day日前より古い+$exの拡張子のファイルを対象に$pathフォルダから削除する\n * \n * @param {string} $path フォルダのパス\n * @param {array} $ex 配列に含まれる拡張子を削除対象とする\n * @param {int} $day $day日前より古いファイルを削除対象とする \n *\n * ※$path = 'folderPath'に削除したいファイルがあるフォルダを指定してください。\n*/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">fileDelete</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$path</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'folderPathを指定する'</span> <span class=\"token punctuation\">,</span><span class=\"token variable\">$ex</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'csv'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">,</span><span class=\"token variable\">$day</span> <span class=\"token operator\">=</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//dirがある、$exが配列、$exの値がある、$dayが整数だったら処理開始</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_dir</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$path</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_int</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$day</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$date</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$dayAgo</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$day</span><span class=\"token operator\">-></span><span class=\"token function\">modify</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'-'</span><span class=\"token operator\">.</span><span class=\"token variable\">$day</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'days'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getTimestamp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//確認するときは ->format(Y-m-d H:i:s) すると日時でみれます</span>\n\n    <span class=\"token variable\">$dir</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectoryIterator</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$dir</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//. と .. は無視する</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$file</span><span class=\"token operator\">-></span><span class=\"token function\">isDot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">//ファイルの時の処理</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">-></span><span class=\"token function\">isFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">//$dayAgoより古い &amp; 対象の拡張子のファイルを削除</span>\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">-></span><span class=\"token function\">getMTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token variable\">$dayAgo</span>  <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">-></span><span class=\"token function\">getExtension</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$ex</span><span class=\"token punctuation\">,</span><span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">-></span><span class=\"token function\">getPathname</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">//ディレクトリの時の処理</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">-></span><span class=\"token function\">isDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          <span class=\"token function\">fileDelete</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">-></span><span class=\"token function\">getPathname</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//ディレクトリなら再帰処理</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>","frontmatter":{"date":"2020-11-25","update_at":"2020-11-26","title":"【PHP】ディレクトリにあるファイルを削除する関数","hero_image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8b898","images":{"fallback":{"src":"/static/57da643dde754066622bc1bac108f77d/3c367/file_icatch.jpg","srcSet":"/static/57da643dde754066622bc1bac108f77d/19e71/file_icatch.jpg 128w,\n/static/57da643dde754066622bc1bac108f77d/68974/file_icatch.jpg 256w,\n/static/57da643dde754066622bc1bac108f77d/3c367/file_icatch.jpg 512w","sizes":"(min-width: 512px) 512px, 100vw"},"sources":[{"srcSet":"/static/57da643dde754066622bc1bac108f77d/6766a/file_icatch.webp 128w,\n/static/57da643dde754066622bc1bac108f77d/22bfc/file_icatch.webp 256w,\n/static/57da643dde754066622bc1bac108f77d/d689f/file_icatch.webp 512w","type":"image/webp","sizes":"(min-width: 512px) 512px, 100vw"}]},"width":512,"height":512}}}}}},"pageContext":{"id":"48b36b85-8c41-593a-980a-f51d7f2b65cc"}},"staticQueryHashes":["2786925534","3000541721","3159585216","3358258035","426580341","602374650"],"slicesMap":{}}